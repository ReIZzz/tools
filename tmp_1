update tb_bs_client_rp cr
set cr.supervisor_id = (select sr.supervisor_id
                          from (select sr.mon_date,
                                       sr.item_name, 
                                       sr.supervisor_id,
                                       row_number() over (partition by sr.item_name order by sr.supervisor_id) as rn,
                                       rank() over (partition by sr.supervisor_id order by sr.mon_date desc) as rk
                                  from CPX.SWD_REPORT sr
                                 where sr.mon_date >= date'2024-01-01'   -- add_months(sysdate, -3)
                                   and sr.item_level = 'лалЪ'
                               ) sr
                         where sr.rn = 1
                           and sr.rk = 1
                           and cr.employee_name = sr.item_name)
